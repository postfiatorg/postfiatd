<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rippled: Validator Exclusion List System Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rippled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Validator Exclusion List System Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md196"></a>
Overview</h1>
<p >The Validator Exclusion List system allows validators to exclude specific accounts from participating in the network. This is a consensus-based mechanism where an account is only excluded if a sufficient percentage of validators (67% by default) agree to exclude it. The system supports two methods for managing exclusion lists:</p>
<ol type="1">
<li><b>Static Configuration</b> - Exclusions defined in the validator's configuration file</li>
<li><b>Remote Fetching</b> - Dynamic exclusion lists fetched from remote sources and cryptographically verified</li>
</ol>
<h1><a class="anchor" id="autotoc_md197"></a>
System Architecture</h1>
<h2><a class="anchor" id="autotoc_md198"></a>
Key Components</h2>
<ol type="1">
<li><b>ExclusionManager</b> - Core component that maintains the consensus view of excluded accounts</li>
<li><b>ValidatorExclusionManager</b> - Manages a validator's own exclusion list and rate-limits changes</li>
<li><b>RemoteExclusionListFetcher</b> - Fetches and verifies signed exclusion lists from remote sources</li>
<li><b>AccountSet Transaction</b> - On-chain mechanism for validators to update their exclusion lists</li>
<li><b>exclusion_info RPC</b> - Query interface to inspect current exclusion states</li>
</ol>
<h1><a class="anchor" id="autotoc_md199"></a>
Method 1: Configuration File-Based Exclusions</h1>
<h2><a class="anchor" id="autotoc_md200"></a>
Configuration Format</h2>
<p >Add exclusions directly to your validator's configuration file:</p>
<div class="fragment"><div class="line">[validator_exclusions]</div>
<div class="line"># List of account addresses to exclude</div>
<div class="line"># One address per line</div>
<div class="line">rN7n7otQDd6FczFgLdSqtcsAUxDkw6fzRH</div>
<div class="line">rf1BiGeXwwQoi8Z2ueFYTEXSwuJYfV2Jpn</div>
<div class="line">rJ6Bq42segvi7djJmt3QV3cRaCNnfVvTaS</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md201"></a>
How It Works</h2>
<ol type="1">
<li>On startup, the validator reads the <code>[validator_exclusions]</code> section</li>
<li>These addresses are stored in <code>ValidatorExclusionManager</code></li>
<li>When the first ledger is validated, the manager compares the configured list with the on-chain state</li>
<li>Differences are queued as pending changes</li>
<li>Changes are applied gradually (one every 10 ledgers) to avoid network disruption</li>
</ol>
<h2><a class="anchor" id="autotoc_md202"></a>
Characteristics</h2>
<ul>
<li><b>Persistent</b>: Remains in effect until manually changed</li>
<li><b>Simple</b>: No external dependencies or signatures required</li>
<li><b>Static</b>: Requires restart to update</li>
<li><b>Individual</b>: Each validator manages their own list</li>
</ul>
<h1><a class="anchor" id="autotoc_md203"></a>
Method 2: Remote Fetcher with Signed Lists</h1>
<h2><a class="anchor" id="autotoc_md204"></a>
Configuration</h2>
<p >Configure remote sources in the validator configuration file:</p>
<div class="fragment"><div class="line">[validator_exclusions_sources]</div>
<div class="line"># Format: url|public_key</div>
<div class="line">https://example.com/exclusions.json|nHUeeJCSY2dM71oxM8Cgjouf5ekTuev2mwDpc374aLMxzDLXNmjf</div>
<div class="line">https://backup.com/list.json|nHB9CJAWyB4rj91VRWn96DkukG4bwdtyTh5VKm3mxZrMT5jST5</div>
<div class="line"> </div>
<div class="line">[validator_exclusions_interval]</div>
<div class="line"># How often to fetch updates (in seconds)</div>
<div class="line">300  # Default: 5 minutes</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md205"></a>
Remote List JSON Format</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: &quot;1.0&quot;,</div>
<div class="line">  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;,</div>
<div class="line">  &quot;issuer_address&quot;: &quot;rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh&quot;,</div>
<div class="line">  &quot;exclusions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;address&quot;: &quot;rN7n7otQDd6FczFgLdSqtcsAUxDkw6fzRH&quot;,</div>
<div class="line">      &quot;reason&quot;: &quot;Malicious activity detected&quot;,</div>
<div class="line">      &quot;date_added&quot;: &quot;2024-01-10&quot;</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;address&quot;: &quot;rf1BiGeXwwQoi8Z2ueFYTEXSwuJYfV2Jpn&quot;,</div>
<div class="line">      &quot;reason&quot;: &quot;Spam transactions&quot;,</div>
<div class="line">      &quot;date_added&quot;: &quot;2024-01-12&quot;</div>
<div class="line">    }</div>
<div class="line">  ],</div>
<div class="line">  &quot;signature&quot;: {</div>
<div class="line">    &quot;algorithm&quot;: &quot;ed25519&quot;,</div>
<div class="line">    &quot;public_key&quot;: &quot;nHUeeJCSY2dM71oxM8Cgjouf5ekTuev2mwDpc374aLMxzDLXNmjf&quot;,</div>
<div class="line">    &quot;signature&quot;: &quot;3045022100a1b2c3d4e5f6...&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md206"></a>
How Remote Fetching Works</h2>
<ol type="1">
<li><b>Startup</b>: <code>RemoteExclusionListFetcher</code> starts when the validator initializes</li>
<li><b>Periodic Fetching</b>: Lists are fetched every <code>validator_exclusions_interval</code> seconds</li>
<li><b>Verification</b>: Each fetched list is cryptographically verified using the configured public key</li>
<li><b>Consolidation</b>: All verified lists are combined into a single exclusion set</li>
<li><b>Update Detection</b>: When changes are detected, they're queued for gradual application</li>
<li><b>Reason Storage</b>: Exclusion reasons are stored in memory (not on-chain) and available via RPC</li>
</ol>
<h2><a class="anchor" id="autotoc_md207"></a>
Security Features</h2>
<ul>
<li><b>Cryptographic Verification</b>: All lists must be signed with Ed25519 keys</li>
<li><b>All-or-Nothing Initial Fetch</b>: On first startup, ALL configured sources must be accessible</li>
<li><b>Partial Updates Allowed</b>: After initial fetch, system continues with available sources</li>
<li><b>Signature Validation</b>: Invalid signatures cause the list to be rejected</li>
</ul>
<h1><a class="anchor" id="autotoc_md208"></a>
Python Script for Creating Signed Exclusion Lists</h1>
<h2><a class="anchor" id="autotoc_md209"></a>
Script: &lt;tt&gt;sign_exclusion_list.py&lt;/tt&gt;</h2>
<p >Located at: <code>/scripts/sign_exclusion_list.py</code></p>
<h2><a class="anchor" id="autotoc_md210"></a>
Prerequisites</h2>
<div class="fragment"><div class="line">pip install nacl base58</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md211"></a>
Usage</h2>
<div class="fragment"><div class="line">python3 sign_exclusion_list.py \</div>
<div class="line">  --secret-key YOUR_ED25519_SECRET_KEY_HEX \</div>
<div class="line">  --input exclusions.json \</div>
<div class="line">  --output signed_exclusions.json</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md212"></a>
Input Format (exclusions.json)</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: &quot;1.0&quot;,</div>
<div class="line">  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;,</div>
<div class="line">  &quot;issuer_address&quot;: &quot;rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh&quot;,</div>
<div class="line">  &quot;exclusions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;address&quot;: &quot;rN7n7otQDd6FczFgLdSqtcsAUxDkw6fzRH&quot;,</div>
<div class="line">      &quot;reason&quot;: &quot;Security violation&quot;,</div>
<div class="line">      &quot;date_added&quot;: &quot;2024-01-10&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md213"></a>
How the Script Works</h2>
<ol type="1">
<li><b>Reads</b> the input JSON file containing the exclusion list</li>
<li><b>Creates</b> a canonical message for signing:<ul>
<li>Format: <code>v1:version:timestamp:issuer_address:sorted_addresses</code></li>
<li>Addresses are sorted alphabetically for consistency</li>
</ul>
</li>
<li><b>Signs</b> the message using Ed25519 with your secret key</li>
<li><b>Derives</b> the public key from the secret key</li>
<li><b>Encodes</b> the public key in XRPL format (Base58 with 'n' prefix)</li>
<li><b>Adds</b> the signature to the JSON</li>
<li><b>Writes</b> the signed JSON to the output file</li>
</ol>
<h2><a class="anchor" id="autotoc_md214"></a>
Key Generation</h2>
<p >To generate an Ed25519 key pair for signing:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> nacl.signing</div>
<div class="line"><span class="keyword">import</span> nacl.encoding</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Generate a new signing key</span></div>
<div class="line">signing_key = nacl.signing.SigningKey.generate()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get the secret key in hex (32 bytes)</span></div>
<div class="line">secret_key_hex = signing_key.encode(encoder=nacl.encoding.HexEncoder).decode(<span class="stringliteral">&#39;ascii&#39;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;Secret key (keep private): {secret_key_hex}&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># The public key will be automatically derived and encoded by the script</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md215"></a>
Consensus Mechanism</h1>
<h2><a class="anchor" id="autotoc_md216"></a>
How Exclusion Consensus Works</h2>
<ol type="1">
<li><b>Vote Collection</b>: Each validator maintains their own exclusion list on-chain</li>
<li><b>Vote Counting</b>: The ExclusionManager counts how many validators exclude each address</li>
<li><b>Threshold Calculation</b>: Default threshold is 67% (minCONSENSUS_PCT)</li>
<li><b>Consensus Determination</b>: An address is considered excluded if votes &gt;= threshold</li>
<li><b>Real-time Updates</b>: The consensus view updates as validators change their lists</li>
</ol>
<h2><a class="anchor" id="autotoc_md217"></a>
Rate Limiting</h2>
<p >To prevent network disruption, changes are rate-limited:</p><ul>
<li><b>One change per 10 ledgers</b>: Maximum rate of updates</li>
<li><b>Gradual application</b>: Large list changes are queued and applied over time</li>
<li><b>Add before remove</b>: When replacing lists, additions happen before removals</li>
</ul>
<h1><a class="anchor" id="autotoc_md218"></a>
RPC Interface: exclusion_info</h1>
<h2><a class="anchor" id="autotoc_md219"></a>
Query All Validators</h2>
<div class="fragment"><div class="line">curl -X POST http://localhost:5005 -d &#39;{</div>
<div class="line">  &quot;method&quot;: &quot;exclusion_info&quot;,</div>
<div class="line">  &quot;params&quot;: [{}]</div>
<div class="line">}&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md220"></a>
Query Specific Validator</h2>
<div class="fragment"><div class="line">curl -X POST http://localhost:5005 -d &#39;{</div>
<div class="line">  &quot;method&quot;: &quot;exclusion_info&quot;,</div>
<div class="line">  &quot;params&quot;: [{</div>
<div class="line">    &quot;validator&quot;: &quot;rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh&quot;</div>
<div class="line">  }]</div>
<div class="line">}&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md221"></a>
Response Format</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;validators&quot;: {</div>
<div class="line">    &quot;rValidator1&quot;: {</div>
<div class="line">      &quot;exclusion_list&quot;: [</div>
<div class="line">        {</div>
<div class="line">          &quot;address&quot;: &quot;rExcludedAccount1&quot;,</div>
<div class="line">          &quot;reason&quot;: &quot;Malicious activity&quot;,</div>
<div class="line">          &quot;date_added&quot;: &quot;2024-01-10&quot;</div>
<div class="line">        }</div>
<div class="line">      ],</div>
<div class="line">      &quot;exclusion_count&quot;: 1</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;excluded_accounts&quot;: {</div>
<div class="line">    &quot;rExcludedAccount1&quot;: {</div>
<div class="line">      &quot;exclusion_count&quot;: 5,</div>
<div class="line">      &quot;percentage&quot;: 71,</div>
<div class="line">      &quot;meets_threshold&quot;: true,</div>
<div class="line">      &quot;reason&quot;: &quot;Malicious activity&quot;,</div>
<div class="line">      &quot;date_added&quot;: &quot;2024-01-10&quot;</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;total_validators&quot;: 7,</div>
<div class="line">  &quot;consensus_threshold&quot;: 5,</div>
<div class="line">  &quot;consensus_percentage&quot;: 67</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md222"></a>
Operational Workflow</h1>
<h2><a class="anchor" id="autotoc_md223"></a>
Setting Up Exclusion Lists</h2>
<ol type="1">
<li><b>Choose Method</b>:<ul>
<li>Use configuration file for simple, static lists</li>
<li>Use remote fetcher for dynamic, managed lists</li>
</ul>
</li>
<li><b>For Configuration File</b>: <div class="fragment"><div class="line">[validator_exclusions]</div>
<div class="line">rBadAccount1</div>
<div class="line">rBadAccount2</div>
</div><!-- fragment --></li>
<li><b>For Remote Lists</b>:<ul>
<li>Set up a web server to host the JSON file</li>
<li>Create and sign the exclusion list using the Python script</li>
<li>Configure validators to fetch from your server</li>
<li>Update the list as needed and re-sign</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md224"></a>
Best Practices</h2>
<ol type="1">
<li><b>Security</b>:<ul>
<li>Keep signing keys secure and never expose them</li>
<li>Use HTTPS for remote list hosting</li>
<li>Regularly rotate signing keys</li>
</ul>
</li>
<li><b>Coordination</b>:<ul>
<li>Coordinate with other validators before major exclusions</li>
<li>Document reasons for exclusions</li>
<li>Consider the consensus threshold when planning exclusions</li>
</ul>
</li>
<li><b>Monitoring</b>:<ul>
<li>Regularly check <code>exclusion_info</code> RPC to verify exclusions</li>
<li>Monitor logs for fetch failures or signature errors</li>
<li>Set up alerts for consensus threshold changes</li>
</ul>
</li>
<li><b>Updates</b>:<ul>
<li>Plan exclusion list updates during low-traffic periods</li>
<li>Test changes on testnet first</li>
<li>Keep backup sources for remote lists</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md225"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md226"></a>
Common Issues</h2>
<ol type="1">
<li><b>Reasons not showing in RPC</b>:<ul>
<li>Verify remote lists are being fetched successfully</li>
<li>Check that the JSON includes reason fields</li>
<li>Ensure the RemoteExclusionListFetcher is running</li>
<li>Look for "Updated ExclusionManager with X exclusion reasons" in logs</li>
</ul>
</li>
<li><b>Remote lists not updating</b>:<ul>
<li>Check network connectivity to source URLs</li>
<li>Verify signature is valid</li>
<li>Ensure public key in config matches signing key</li>
<li>Check logs for fetch errors</li>
</ul>
</li>
<li><b>Exclusions not taking effect</b>:<ul>
<li>Verify consensus threshold is met</li>
<li>Check that enough validators are excluding the account</li>
<li>Use <code>exclusion_info</code> RPC to see vote counts</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md227"></a>
Log Messages to Monitor</h2>
<div class="fragment"><div class="line">RemoteExclusionListFetcher: Successfully fetched and verified from &lt;url&gt;</div>
<div class="line">ValidatorExclusionManager: Updated ExclusionManager with X exclusion reasons</div>
<div class="line">ExclusionManager: Rebuilding exclusion cache from ledger</div>
<div class="line">ValidatorExclusionManager: X pending changes queued</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md228"></a>
Architecture Details</h1>
<h2><a class="anchor" id="autotoc_md229"></a>
Data Flow</h2>
<div class="fragment"><div class="line">Configuration File ─┐</div>
<div class="line">                    ├─&gt; ValidatorExclusionManager ─&gt; AccountSet TX ─&gt; Ledger</div>
<div class="line">Remote Sources ─────┘                                                    │</div>
<div class="line">     │                                                                   │</div>
<div class="line">     └─&gt; ExclusionManager &lt;──────────────────────────────────────────────┘</div>
<div class="line">              │</div>
<div class="line">              └─&gt; exclusion_info RPC</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md230"></a>
Storage</h2>
<ul>
<li><b>On-chain</b>: Account addresses only (no reasons or metadata)</li>
<li><b>In-memory</b>: Reasons, dates, and other metadata from remote sources</li>
<li><b>Configuration</b>: Static exclusion lists and remote source URLs</li>
</ul>
<h1><a class="anchor" id="autotoc_md231"></a>
Security Considerations</h1>
<ol type="1">
<li><b>No On-chain Reasons</b>: Exclusion reasons are never stored on-chain to prevent legal issues</li>
<li><b>Signature Verification</b>: All remote lists must be cryptographically signed</li>
<li><b>Consensus Requirement</b>: No single validator can exclude an account</li>
<li><b>Rate Limiting</b>: Prevents rapid changes that could destabilize the network</li>
<li><b>All-or-Nothing Initial Fetch</b>: Ensures consistency on startup </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
