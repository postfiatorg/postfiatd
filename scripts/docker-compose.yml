version: '3.8'
services:
  postfiatd:
    image: mfrankovi/postfiatd:testnet-latest
    container_name: postfiatd
    # Port mappings
    ports:
      - "5005:5005"
      - "2559:2559"
      - "6005:6005"
      - "6006:6006"
      - "50051:50051"
    # Volume mappings
    volumes:
      - postfiatd-config:/etc/postfiatd
      - postfiatd-data:/var/lib/postfiatd/db
      - ./logs:/var/log/postfiatd
    # Run as root (default)
    user: "0:0"
    # Restart policy
    restart: unless-stopped
    # Docker container log limits
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "10"

  # Log cleanup service
  log-cleanup:
    image: alpine:latest
    container_name: postfiatd-log-cleanup
    volumes:
      - ./logs:/logs
    command: >
      sh -c "
      while true; do
        find /logs -name '*.log' -type f -size +100M -exec truncate -s 100M {} \;
        find /logs -name '*.log.*' -type f -mtime +7 -delete
        sleep 3600
      done"
    restart: unless-stopped

# Named volumes
volumes:
  postfiatd-config:
  postfiatd-data:
