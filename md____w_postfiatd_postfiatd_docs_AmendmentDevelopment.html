<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rippled: Amendment Development Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rippled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Amendment Development Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This guide provides step-by-step instructions for creating new amendments (also called features) in the PostFiat codebase.</p>
<h1><a class="anchor" id="autotoc_md140"></a>
Overview</h1>
<p >Amendments are protocol-level changes that are enabled through validator voting. They allow the network to upgrade in a coordinated, decentralized manner.</p>
<h1><a class="anchor" id="autotoc_md141"></a>
Amendment Types</h1>
<ul>
<li><b>XRPL_FEATURE</b>: New functionality or feature additions</li>
<li><b>XRPL_FIX</b>: Bug fixes and corrections</li>
<li><b>XRPL_RETIRE</b>: Deprecated amendments (kept for historical ledger compatibility)</li>
</ul>
<h1><a class="anchor" id="autotoc_md142"></a>
Development Workflow</h1>
<h2><a class="anchor" id="autotoc_md143"></a>
1. Register the Amendment</h2>
<p >Add your amendment to <code>include/xrpl/protocol/detail/features.macro</code> at the <b>top of the list</b> (reverse chronological order):</p>
<div class="fragment"><div class="line">XRPL_FEATURE(YourFeatureName, Supported::no, VoteBehavior::DefaultNo)</div>
<div class="line"><span class="comment">// or for bug fixes:</span></div>
<div class="line">XRPL_FIX(YourFixName, Supported::no, VoteBehavior::DefaultNo)</div>
</div><!-- fragment --><p ><b>Important</b>: Increment <code>numFeatures</code> in <code><a class="el" href="Feature_8h_source.html">include/xrpl/protocol/Feature.h</a></code> when adding a new amendment.</p>
<h2><a class="anchor" id="autotoc_md144"></a>
2. Implement Feature Logic</h2>
<p >Use the generated variable to control code execution:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (view.rules.enabled(featureYourFeatureName))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// New code path when amendment is enabled</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Legacy code path</span></div>
<div class="line">}</div>
</div><!-- fragment --><p >For fixes, the pattern is similar using <code>fixYourFixName</code>.</p>
<h2><a class="anchor" id="autotoc_md145"></a>
3. Mark as Supported</h2>
<p >When development is <b>complete and tested</b>, update the amendment in <code>features.macro</code>:</p>
<div class="fragment"><div class="line">XRPL_FEATURE(YourFeatureName, Supported::yes, VoteBehavior::DefaultNo)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md146"></a>
4. Choose Activation Strategy</h2>
<p >There are two valid approaches for amendment activation:</p>
<h3><a class="anchor" id="autotoc_md147"></a>
Option A: External Governance (DefaultNo)</h3>
<div class="fragment"><div class="line">XRPL_FEATURE(YourFeatureName, Supported::yes, VoteBehavior::DefaultNo)</div>
</div><!-- fragment --><p >With <code>DefaultNo</code>, validators must explicitly vote for the amendment. This allows the community to coordinate activation timing through external governance:</p>
<ol type="1">
<li><b>Community Discussion</b>: The amendment is discussed in community forums, GitHub, and validator channels</li>
<li><b>Validator Configuration</b>: Validators who wish to support the amendment add it to their <code>rippled.cfg</code>: <div class="fragment"><div class="line">[amendments]</div>
<div class="line">YourFeatureName</div>
</div><!-- fragment --></li>
<li><b>Voting Process</b>: Once 67% of trusted validators vote yes for 2 weeks, the amendment activates</li>
<li><b>Coordination</b>: This approach allows time for ecosystem preparation and coordinated rollout</li>
</ol>
<h3><a class="anchor" id="autotoc_md148"></a>
Option B: Default Voting (DefaultYes)</h3>
<div class="fragment"><div class="line">XRPL_FIX(CriticalFix, Supported::yes, VoteBehavior::DefaultYes)</div>
</div><!-- fragment --><p >With <code>DefaultYes</code>, validators automatically vote for the amendment by default. This is appropriate when:</p><ul>
<li>There's strong community consensus on immediate activation</li>
<li>The fix addresses critical issues that need rapid deployment</li>
<li>Pre-release communication has occurred through appropriate channels</li>
</ul>
<p ><b>Important</b>: Ensure adequate community communication before using <code>DefaultYes</code>.</p>
<h1><a class="anchor" id="autotoc_md149"></a>
Vote Behavior Options</h1>
<ul>
<li><b>VoteBehavior::DefaultNo</b>: Validators won't vote for it by default; requires explicit configuration for activation</li>
<li><b>VoteBehavior::DefaultYes</b>: Validators will vote for it by default; activates automatically when 67% threshold is reached</li>
<li><b>VoteBehavior::Obsolete</b>: Amendment was votable but never passed (kept for compatibility)</li>
</ul>
<h1><a class="anchor" id="autotoc_md150"></a>
Retirement Process</h1>
<p >After an amendment has been enabled for several years (typically 2+), conditional code can be removed:</p>
<ol type="1">
<li><b>Remove conditional logic</b> - Replace feature-gated code with the new behavior</li>
<li><b>Move to retired section</b> in <code>features.macro</code>:</li>
</ol>
<div class="fragment"><div class="line">XRPL_RETIRE(OldFeatureName)</div>
</div><!-- fragment --><p ><b>Note</b>: Retired amendments must remain registered indefinitely because they may exist in ledger history.</p>
<h1><a class="anchor" id="autotoc_md151"></a>
Key Files</h1>
<ul>
<li><code>include/xrpl/protocol/detail/features.macro</code> - Amendment definitions</li>
<li><code><a class="el" href="Feature_8h_source.html">include/xrpl/protocol/Feature.h</a></code> - Feature declarations and <code>numFeatures</code> constant</li>
<li><code><a class="el" href="Feature_8cpp_source.html">src/libxrpl/protocol/Feature.cpp</a></code> - Feature registration implementation</li>
</ul>
<h1><a class="anchor" id="autotoc_md152"></a>
Best Practices</h1>
<ol type="1">
<li>Always add new amendments at the <b>top</b> of <code>features.macro</code></li>
<li>Start with <code>Supported::no</code> during development</li>
<li>Use descriptive, clear names for amendments</li>
<li>Keep amendments focused on a single change</li>
<li>Document the amendment's purpose in code comments</li>
<li>Always test with the amendment both enabled and disabled</li>
<li>Remember to update <code>numFeatures</code> when adding amendments</li>
</ol>
<h1><a class="anchor" id="autotoc_md153"></a>
Testing</h1>
<p >Ensure your amendment works correctly:</p><ul>
<li>Test with amendment disabled (legacy behavior)</li>
<li>Test with amendment enabled (new behavior)</li>
<li>Verify the transition works correctly</li>
<li>Check replay of old ledgers still functions</li>
</ul>
<h1><a class="anchor" id="autotoc_md154"></a>
Variable Naming Convention</h1>
<ul>
<li>Features: <code>feature&lt;Name&gt;</code> (e.g., <code>featureAccountExclusion</code>)</li>
<li>Fixes: <code>fix&lt;Name&gt;</code> (e.g., <code>fixAMMv1_3</code>)</li>
<li>These variables are auto-generated from the macro definitions </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
