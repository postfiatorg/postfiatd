<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rippled: Validator Key and Domain Update Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rippled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Validator Key and Domain Update Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This guide explains how to update your validator's signing key and/or domain configuration. These operations are necessary when you need to rotate keys for security purposes or update your validator's domain information.</p>
<h1><a class="anchor" id="autotoc_md272"></a>
Prerequisites</h1>
<p >Before proceeding, ensure you have:</p>
<ul>
<li>A running Post Fiat validator node</li>
<li>Access to the Docker container running your validator</li>
<li>Your existing <code>validator-keys.json</code> file backed up in a secure location</li>
<li>Docker and Docker Compose installed</li>
</ul>
<h1><a class="anchor" id="autotoc_md273"></a>
Understanding Validator Keys and Tokens</h1>
<p >A Post Fiat validator uses a two-tier key system:</p>
<ul>
<li><b>Master Key Pair</b>: The permanent validator identity (stored in <code>validator-keys.json</code>)</li>
<li><b>Ephemeral Signing Key</b>: A temporary key that can be rotated without changing the validator identity</li>
<li><b>Validator Token</b>: A signed manifest that authorizes a specific signing key for your validator</li>
</ul>
<p >When you update the signing key or domain, you generate a new validator token that includes:</p><ul>
<li>Your master public key (validator identity)</li>
<li>A new ephemeral signing key</li>
<li>The domain (optional)</li>
<li>A sequence number (incremented with each new token)</li>
<li>Signatures from both the master key and ephemeral signing key</li>
</ul>
<h1><a class="anchor" id="autotoc_md274"></a>
Generating a New Token</h1>
<p >All validator updates (whether updating the signing key, domain, or both) involve generating a new validator token. This section explains the token generation process that applies to all scenarios.</p>
<h2><a class="anchor" id="autotoc_md275"></a>
Prerequisites</h2>
<p >Before generating a new token, you must have:</p>
<p ><b>Existing validator master keys</b>: Your <code>validator-keys.json</code> file must already exist and contain your validator's master key pair and the current sequence number. This file should be located at <code>/home/ubuntu/.ripple/validator-keys.json</code> (or <code>~/.ripple/validator-keys.json</code>).</p>
<h2><a class="anchor" id="autotoc_md276"></a>
When to Generate a New Token</h2>
<p >You should generate a new validator token when:</p>
<ul>
<li>Rotating your signing key periodically as a security best practice (e.g., every 6-12 months)</li>
<li>You suspect the current signing key may have been compromised</li>
<li>Moving your validator to new hardware</li>
<li>Updating or setting your validator's domain</li>
<li>As part of routine security maintenance</li>
</ul>
<h2><a class="anchor" id="autotoc_md277"></a>
Access the Validator Keys Tool</h2>
<p >For all token generation operations, first enter the running Docker container:</p>
<div class="fragment"><div class="line">docker exec -it postfiatd bash</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md278"></a>
Updating the Signing Key Only</h1>
<p >Use this method when you want to rotate your signing key while keeping your existing domain unchanged.</p>
<h2><a class="anchor" id="autotoc_md279"></a>
Generate a New Token</h2>
<p >Generate a new validator token (this will keep your existing domain if you have one):</p>
<div class="fragment"><div class="line">validator-keys create_token</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md280"></a>
Updating the Domain (and Signing Key)</h1>
<p >Use this method when you want to set or change your validator's domain. <b>Note that <code>set_domain</code> automatically generates a new signing key along with the domain update</b>, so you get both updates in one operation.</p>
<h2><a class="anchor" id="autotoc_md281"></a>
Set the New Domain</h2>
<p >The <code>set_domain</code> command generates a new token with both a new signing key and your specified domain:</p>
<div class="fragment"><div class="line">validator-keys set_domain your-domain.com</div>
</div><!-- fragment --><p ><b>Important</b>: The domain should be entered without the protocol (no <code><a href="https://">https://</a></code> or <code><a href="http://">http://</a></code>). For example:</p><ul>
<li>Correct: <code>validator.example.com</code> or <code>example.com</code></li>
<li>Incorrect: <code><a href="https://example.com">https://example.com</a></code></li>
</ul>
<p ><b>Sample output:</b></p>
<div class="fragment"><div class="line">The validator key pair is generated.</div>
<div class="line"> </div>
<div class="line">Update postfiatd.cfg file with these values:</div>
<div class="line"> </div>
<div class="line"># validator public key: nHUtNnLVx7odrz5dnfb2xpIgbEeJPbzJWfdicSkGyVw1eE5GpjQr</div>
<div class="line"> </div>
<div class="line">[validator_token]</div>
<div class="line">eyJ2YWxpZGF0aW9uX3NlY3J|dF9rZXkiOiI5ZWQ0NWY4NjYyNDFjYzE4YTI3NDdiNT</div>
<div class="line">QzODdjMDYyNTkwNzk3MmY0ZTcxOTAyMzFmYWE5Mzc0NTdmYT|kYWY2IiwibWFuaWZl</div>
<div class="line">c3QiOiJKQUFBQUFGeEllMUZ0d21pbXZHdEgyaUNjTUpxQzlnVkZLaWxHZncxL3ZDeE</div>
<div class="line">hYWExwbGMyR25NaEFrRTFhZ3FYeEJ3RHdEYklENk9NU1l1TTBGREFscEFnTms4U0tG</div>
<div class="line">bjdNTzJmZGtjd1JRSWhBT25ndTlzQUtxWFlvdUorbDJWMFcrc0FPa1ZCK1pSUzZQU2</div>
<div class="line">hsSkFmVXNYZkFpQnNWSkdlc2FhZE9KYy9hQVpva1MxdnltR21WcmxIUEtXWDNZeXd1</div>
<div class="line">NmluOEhBU1FLUHVnQkQ2N2tNYVJGR3ZtcEFUSGxHS0pkdkRGbFdQWXk1QXFEZWRGdj</div>
<div class="line">VUSmEydzBpMjFlcTNNWXl3TFZKWm5GT3I3QzBrdzJBaVR6U0NqSXpkaXRROD0ifQ==</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md282"></a>
Update the Configuration</h2>
<p >After generating a new token (regardless of the method used), you need to update the configuration file.</p>
<p ><b>Option A: Direct edit (if you have access to the volume)</b></p>
<div class="fragment"><div class="line">nano /var/lib/docker/volumes/postfiatd_postfiatd-config/_data/postfiatd.cfg</div>
</div><!-- fragment --><p ><b>Option B: Edit from within the container</b></p>
<div class="fragment"><div class="line"># From within the container</div>
<div class="line">nano /root/.config/ripple/postfiatd.cfg</div>
</div><!-- fragment --><p >Find the existing <code>[validator_token]</code> section and replace it with the new token. The configuration file should contain only <b>one</b> <code>[validator_token]</code> section.</p>
<p ><b>Before:</b> </p><div class="fragment"><div class="line">[validator_token]</div>
<div class="line">eyJ... [OLD TOKEN] ...ifQ==</div>
</div><!-- fragment --><p ><b>After:</b> </p><div class="fragment"><div class="line">[validator_token]</div>
<div class="line">eyJ... [NEW TOKEN] ...ifQ==</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md283"></a>
Restart the Validator</h2>
<p >Exit the container and restart it to apply the changes:</p>
<div class="fragment"><div class="line">exit</div>
<div class="line">docker-compose restart</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md284"></a>
Important Considerations</h1>
<h2><a class="anchor" id="autotoc_md285"></a>
Token Sequence Numbers</h2>
<ul>
<li>Each new token has a higher sequence number than the previous one</li>
<li>Nodes on the network will automatically accept the new token if the sequence number is higher</li>
<li>Old tokens are automatically invalidated when a new token is published</li>
<li>There is a hard limit of 4,294,967,293 tokens per validator key pair</li>
</ul>
<h2><a class="anchor" id="autotoc_md286"></a>
Propagation Time</h2>
<ul>
<li>New tokens propagate through the network automatically</li>
<li>Other validators will detect and accept the new manifest within minutes</li>
<li>No coordination with other operators is required</li>
<li>The validator identity (master public key) remains unchanged</li>
</ul>
<h2><a class="anchor" id="autotoc_md287"></a>
Key File Management</h2>
<ul>
<li><b>Never lose your <code>validator-keys.json</code> file</b> - it contains your validator identity</li>
<li>Keep secure backups in multiple locations (encrypted USB drives, secure cloud storage, etc.)</li>
<li>The key file should be protected with appropriate file permissions</li>
<li>Consider keeping the key file offline and only accessing it when needed for key operations</li>
</ul>
<h2><a class="anchor" id="autotoc_md288"></a>
Security Best Practices</h2>
<ol type="1">
<li><b>Rotation Schedule</b>: Establish a regular key rotation schedule (e.g., quarterly or semi-annually)</li>
<li><b>Secure Environment</b>: Perform key operations in a secure, isolated environment</li>
<li><b>Backup Before Changes</b>: Always backup your current configuration before making changes</li>
<li><b>Monitor After Updates</b>: Watch logs and network status after updating to ensure proper operation</li>
<li><b>Document Changes</b>: Keep a record of when keys were rotated and why</li>
</ol>
<h1><a class="anchor" id="autotoc_md289"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md290"></a>
Token Not Accepted</h2>
<p >If your new token is not being accepted:</p>
<ol type="1">
<li>Verify the sequence number is higher than the previous token</li>
<li>Check that the token is properly formatted in the config file (no extra spaces or line breaks within the token)</li>
<li>Ensure the <code>[validator_token]</code> section header is present</li>
<li>Confirm there is only one <code>[validator_token]</code> section in the config</li>
</ol>
<h2><a class="anchor" id="autotoc_md291"></a>
Validator Not Showing in Network</h2>
<p >If your validator doesn't appear in the network after updating:</p>
<ol type="1">
<li>Check container logs: <code>docker-compose logs -f</code></li>
<li>Verify the validator token is correctly formatted</li>
<li>Ensure the config file was saved properly</li>
<li>Confirm the container restarted successfully: <code>docker-compose ps</code></li>
<li>Check network connectivity and peer connections</li>
</ol>
<h2><a class="anchor" id="autotoc_md292"></a>
Domain Not Appearing</h2>
<p >If the domain is not showing for your validator:</p>
<ol type="1">
<li>Verify you used the correct format (no protocol, e.g., <code>example.com</code> not <code><a href="https://example.com">https://example.com</a></code>)</li>
<li>Confirm the token was generated with the domain parameter</li>
<li>Allow time for the manifest to propagate through the network (usually a few minutes)</li>
<li>Check that your domain is accessible and properly configured</li>
</ol>
<h1><a class="anchor" id="autotoc_md293"></a>
Related Documentation</h1>
<ul>
<li><a class="el" href="md____w_postfiatd_postfiatd_docs_NodeSetup.html">NodeSetup.md</a> - Initial validator setup guide</li>
<li><a href="https://explorer.testnet.postfiat.org/network/validators">Post Fiat Explorer</a> - Monitor validator status</li>
</ul>
<h1><a class="anchor" id="autotoc_md294"></a>
Getting Help</h1>
<p >If you encounter issues not covered in this guide:</p>
<ol type="1">
<li>Check container status: <code>docker-compose ps</code></li>
<li>Review logs: <code>docker-compose logs -f</code></li>
<li>Verify configuration: Check for syntax errors in <code>postfiatd.cfg</code></li>
<li>Consult the community or open an issue on the project repository </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
